---
AIGC:
    ContentProducer: Minimax Agent AI
    ContentPropagator: Minimax Agent AI
    Label: AIGC
    ProduceID: 978969ea2eda9f8e182e826246f9c2b6
    PropagateID: 978969ea2eda9f8e182e826246f9c2b6
    ReservedCode1: 304402201c8f46f2e824174e1b01ccfdd930edcac084dc90572461bcb9c666a90845633602204ae2bb876af4ce16b721cf9b3dc3d4e7129d491416fd39cc5e8246e10fab421c
    ReservedCode2: 3045022100a77240f47f226b5eb8f78509eb167cb4833ff584e5e09ae542ead682e4c9755e02207d77fa1023523004c160098d72a8d4dbad46feb18a2999ac6e94faebec201415
---

# Novel AI Forge - AIå°è¯´åˆ›ä½œå¹³å°

> ä¸€ä¸ªé›†æˆå¤šç§AIæ¨¡å‹çš„å°è¯´åˆ›ä½œå¹³å°ï¼Œæ”¯æŒå¤šçº¿ç¨‹å†™ä½œå’Œæ™ºèƒ½å¯¹è¯

## ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ“ä½œç³»ç»Ÿç‰¹å®šæŒ‡å¼•](#æ“ä½œç³»ç»Ÿç‰¹å®šæŒ‡å¼•)
  - [Windowséƒ¨ç½²](#windowséƒ¨ç½²)
  - [macOSéƒ¨ç½²](#macoséƒ¨ç½²)
  - [Linuxéƒ¨ç½²](#linuxéƒ¨ç½²)
- [éƒ¨ç½²æ–¹å¼](#éƒ¨ç½²æ–¹å¼)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [ç»´æŠ¤ä¸ç›‘æ§](#ç»´æŠ¤ä¸ç›‘æ§)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [å®‰å…¨å»ºè®®](#å®‰å…¨å»ºè®®)

## é¡¹ç›®æ¦‚è¿°

Novel AI Forge æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„AIé©±åŠ¨å°è¯´åˆ›ä½œå¹³å°ï¼Œä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š

- ğŸ¤– **å¤šAIæ¨¡å‹é›†æˆ**ï¼šæ”¯æŒOpenAIã€Anthropicã€é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€ã€æŠ–éŸ³è±†åŒ…ç­‰å¤šç§AIæœåŠ¡
- ğŸ“ **æ™ºèƒ½ç¼–è¾‘å™¨**ï¼šåŸºäºTipTapçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒMarkdown
- ğŸ—‚ï¸ **é¡¹ç›®ç®¡ç†**ï¼šå®Œæ•´çš„å°è¯´é¡¹ç›®ç®¡ç†ï¼ŒåŒ…å«ç« èŠ‚ã€è§’è‰²ã€ä¸–ç•Œè§‚è®¾å®š
- ğŸ§  **é¡¹ç›®åœ£ç»**ï¼šRAGç³»ç»Ÿç®¡ç†è§’è‰²å…³ç³»å’Œä¸–ç•Œè§‚è®¾å®š
- ğŸ’¾ **æœ¬åœ°ä¼˜å…ˆ**ï¼šä½¿ç”¨PouchDBå®ç°ç¦»çº¿å­˜å‚¨
- ğŸ”§ **ç”Ÿäº§å°±ç»ª**ï¼šæ”¯æŒDockerã€PM2ã€Vercelç­‰å¤šç§éƒ¨ç½²æ–¹å¼

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– å¤šæ¨¡å‹é›†æˆ
- **OpenAI** (GPT-4ã€GPT-4 Turboã€GPT-3.5 Turbo)
- **Anthropic Claude** (Claude Sonnetã€Claude Haikuã€Claude Opus)
- **é€šä¹‰åƒé—®** (Qwen Turboã€Qwen Plusã€Qwen Max)
- **æ–‡å¿ƒä¸€è¨€** (ERNIE 4.0ã€ERNIE 3.5)
- **è±†åŒ…** (Doubao Proã€Doubao Lite)

### ğŸ“– ä½œå“ç®¡ç†
- åˆ›å»ºå’Œç®¡ç†å¤šä¸ªå°è¯´é¡¹ç›®
- ç« èŠ‚ç»“æ„åŒ–ç®¡ç†
- è‡ªåŠ¨ä¿å­˜åŠŸèƒ½

### ğŸ­ ä½œå“åœ£ç»ç³»ç»Ÿ
- **è§’è‰²è®¾å®š**ï¼šåˆ›å»ºå’Œç®¡ç†è§’è‰²å¡ç‰‡ï¼ŒåŒ…å«å¤–è²Œã€æ€§æ ¼ã€èƒŒæ™¯ã€ç§˜å¯†ç­‰ä¿¡æ¯
- **åœ°ç‚¹è®¾å®š**ï¼šç®¡ç†æ•…äº‹å‘ç”Ÿåœ°ç‚¹
- **ç‰©å“è®¾å®š**ï¼šè®°å½•é‡è¦é“å…·å’Œé­”æ³•ç‰©å“

### âœï¸ æ™ºèƒ½ç¼–è¾‘å™¨
- åŸºäºTipTapçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- Markdownè¯­æ³•æ”¯æŒ
- é€‰ä¸­æ–‡å­—å¿«æ·AIæ“ä½œ
- æµ®åŠ¨å·¥å…·æ 

### ğŸ’¬ AIåŠ©æ‰‹
- å¯¹è¯å¼AIäº¤äº’
- å¤šç§åˆ›ä½œæ¨¡æ¿ï¼ˆç»­å†™ã€æ¶¦è‰²ã€æ”¹å†™ã€å¯¹è¯ç”Ÿæˆç­‰ï¼‰
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆè‡ªåŠ¨æ³¨å…¥è§’è‰²å’Œè®¾å®šä¿¡æ¯ï¼‰

## ç³»ç»Ÿè¦æ±‚

### åŸºç¡€è¦æ±‚

- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 9.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: å»ºè®® 2GB ä»¥ä¸Š
- **å­˜å‚¨**: è‡³å°‘ 1GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºAI APIè°ƒç”¨ï¼‰

### å¼€å‘ç¯å¢ƒ

- **Git**: ç”¨äºä»£ç ç®¡ç†
- **VS Code** æˆ–å…¶ä»–ç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰
- **Docker**: å¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd novel-ai-forge
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š

```bash
# Windows
copy .env.example .env

# macOS/Linux
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# APIå¯†é’¥é…ç½®ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
OPENAI_API_KEY=your-openai-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key
QWEN_API_KEY=your-qwen-api-key
ERNIE_API_KEY=your-ernie-api-key
DOUBAO_API_KEY=your-doubao-api-key

# æœåŠ¡å™¨é…ç½®
NODE_ENV=development
PORT=3000
HOST=localhost
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—® `http://localhost:3000` å³å¯ä½¿ç”¨åº”ç”¨ã€‚

## æ“ä½œç³»ç»Ÿç‰¹å®šæŒ‡å¼•

## Windowséƒ¨ç½²

### æ–¹å¼ä¸€ï¼šDocker Desktopï¼ˆæ¨èï¼‰

1. **å®‰è£…Docker Desktop**
   - ä¸‹è½½å¹¶å®‰è£… [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop/)
   - å¯åŠ¨Docker Desktop

2. **éƒ¨ç½²åº”ç”¨**
```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\path\to\novel-ai-forge

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### æ–¹å¼äºŒï¼šç›´æ¥éƒ¨ç½²

1. **å®‰è£…Node.js**
   - ä» [nodejs.org](https://nodejs.org/) ä¸‹è½½å¹¶å®‰è£… LTS ç‰ˆæœ¬

2. **å®‰è£…PM2**
```powershell
npm install -g pm2
```

3. **æ„å»ºå¹¶å¯åŠ¨**
```powershell
npm install
npm run build
pm2 start ecosystem.config.js

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯åº”ç”¨
pm2 restart novel-ai-forge
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨Windows Service

1. **åˆ›å»ºWindows Service**
```powershell
npm install -g node-windows
npm link node-windows

# åˆ›å»ºæœåŠ¡
node scripts/create-windows-service.js
```

2. **ç®¡ç†æœåŠ¡**
```powershell
# å¯åŠ¨æœåŠ¡
net start novel-ai-forge

# åœæ­¢æœåŠ¡
net stop novel-ai-forge

# æŸ¥çœ‹çŠ¶æ€
sc query novel-ai-forge
```

### Windowsé˜²ç«å¢™é…ç½®

```powershell
# å…è®¸3000ç«¯å£é€šè¿‡é˜²ç«å¢™
netsh advfirewall firewall add rule name="Novel AI Forge" dir=in action=allow protocol=TCP localport=3000
```

### Windowsä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆè‡ªåŠ¨å¤‡ä»½ï¼‰

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è§¦å‘å™¨ï¼šæ¯å¤© 02:00
4. æ“ä½œï¼šå¯åŠ¨ç¨‹åº
5. ç¨‹åºï¼š`C:\path\to\novel-ai-forge\scripts\backup.bat`

## macOSéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šHomebrew + Docker

1. **å®‰è£…Homebrew**
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

2. **å®‰è£…Docker Desktop**
```bash
brew install --cask docker
open /Applications/Docker.app
```

3. **éƒ¨ç½²åº”ç”¨**
```bash
# å…‹éš†æˆ–è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/Desktop/novel-ai-forge

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### æ–¹å¼äºŒï¼šä½¿ç”¨pm2

1. **å®‰è£…ä¾èµ–**
```bash
# ä½¿ç”¨Homebrewå®‰è£…Node.jsï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
brew install node

# å…¨å±€å®‰è£…pm2
npm install -g pm2

# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
```

2. **æ„å»ºå¹¶å¯åŠ¨**
```bash
npm run build
pm2 start ecosystem.config.js

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

3. **ç®¡ç†åº”ç”¨**
```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯åº”ç”¨
pm2 restart novel-ai-forge

# åœæ­¢åº”ç”¨
pm2 stop novel-ai-forge

# åˆ é™¤åº”ç”¨
pm2 delete novel-ai-forge
```

### macOSè‡ªåŠ¨å¯åŠ¨é…ç½®

åˆ›å»ºLaunchAgenté…ç½®ï¼š

```xml
<!-- ~/Library/LaunchAgents/com.novelaiforge.plist -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.novelaiforge</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/local/bin/node</string>
        <string>/path/to/novel-ai-forge/ecosystem.config.js</string>
    </array>
    <key>WorkingDirectory</key>
    <string>/path/to/novel-ai-forge</string>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
```

å¯ç”¨æœåŠ¡ï¼š
```bash
launchctl load ~/Library/LaunchAgents/com.novelaiforge.plist
launchctl start com.novelaiforge
```

### macOSé˜²ç«å¢™å’Œç«¯å£

```bash
# å…è®¸åº”ç”¨é€šè¿‡é˜²ç«å¢™
sudo pfctl -f /etc/pf.conf
sudo pfctl -e

# æˆ–è€…ä½¿ç”¨pf.confæ·»åŠ è§„åˆ™
echo "pass in on lo0 proto tcp from any to any port 3000" | sudo pfctl -f -
```

## Linuxéƒ¨ç½²

### Ubuntu/Debian

1. **å®‰è£…ç³»ç»Ÿä¾èµ–**
```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…PM2
sudo npm install -g pm2

# å®‰è£…Dockerï¼ˆå¯é€‰ï¼‰
sudo apt install docker.io docker-compose
sudo systemctl enable docker
sudo usermod -aG docker $USER
```

2. **éƒ¨ç½²åº”ç”¨**
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd novel-ai-forge

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start ecosystem.config.js
pm2 save
pm2 startup

# æˆ–è€…ä½¿ç”¨Docker
docker-compose up -d
```

### CentOS/RHEL/Fedora

1. **å®‰è£…ç³»ç»Ÿä¾èµ–**
```bash
# CentOS/RHEL
sudo yum install -y nodejs npm

# Fedora
sudo dnf install -y nodejs npm

# å®‰è£…PM2
sudo npm install -g pm2

# å®‰è£…Docker
sudo yum install -y docker
sudo systemctl start docker
sudo systemctl enable docker
```

2. **éƒ¨ç½²åº”ç”¨**ï¼ˆåŒUbuntuæ­¥éª¤ï¼‰

### åˆ›å»ºç³»ç»ŸæœåŠ¡ï¼ˆsystemdï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/novel-ai-forge.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Novel AI Forge - AIå°è¯´åˆ›ä½œå¹³å°
After=network.target

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/var/www/novel-ai-forge
ExecStart=/usr/bin/pm2 start ecosystem.config.js --no-daemon
Restart=always
RestartSec=10
Environment=NODE_ENV=production
Environment=PORT=3000

# å®‰å…¨é…ç½®
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
PrivateTmp=true
ReadWritePaths=/var/www/novel-ai-forge

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable novel-ai-forge
sudo systemctl start novel-ai-forge
sudo systemctl status novel-ai-forge
```

### ä½¿ç”¨Nginxåå‘ä»£ç†

1. **å®‰è£…Nginx**
```bash
# Ubuntu/Debian
sudo apt install nginx

# CentOS/RHEL/Fedora
sudo yum install nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```

2. **é…ç½®è™šæ‹Ÿä¸»æœº**
```bash
sudo nano /etc/nginx/sites-available/novel-ai-forge
```

é…ç½®å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å®‰å…¨å¤´
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json;

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ä¸»åº”ç”¨
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/novel-ai-forge /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### SSLè¯ä¹¦é…ç½®

ä½¿ç”¨Let's Encryptï¼š
```bash
# å®‰è£…certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

## éƒ¨ç½²æ–¹å¼

### 1. Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

æœ€ç®€å•ã€è·¨å¹³å°çš„éƒ¨ç½²æ–¹å¼ï¼š

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°æœåŠ¡
docker-compose down
docker-compose pull
docker-compose up -d
```

### 2. PM2éƒ¨ç½²

é€‚åˆç”Ÿäº§ç¯å¢ƒçš„è¿›ç¨‹ç®¡ç†ï¼š

```bash
# å¯åŠ¨
pm2 start ecosystem.config.js

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# é‡å¯
pm2 restart novel-ai-forge

# åœæ­¢
pm2 stop novel-ai-forge

# åˆ é™¤
pm2 delete novel-ai-forge

# æŸ¥çœ‹æ—¥å¿—
pm2 logs
pm2 logs --lines 100  # æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
```

### 3. Verceléƒ¨ç½²

é€‚åˆå¿«é€ŸåŸå‹å’Œå…è´¹æ‰˜ç®¡ï¼š

```bash
# å®‰è£…Vercel CLI
npm i -g vercel

# éƒ¨ç½²
vercel

# è®¾ç½®ç¯å¢ƒå˜é‡
vercel env add OPENAI_API_KEY
vercel env add ANTHROPIC_API_KEY
```

### 4. ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

ä½¿ç”¨systemdæœåŠ¡ï¼š

```bash
sudo systemctl start novel-ai-forge
sudo systemctl enable novel-ai-forge
sudo systemctl status novel-ai-forge
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `OPENAI_API_KEY` | å¦ | OpenAI APIå¯†é’¥ | sk-xxxxx |
| `ANTHROPIC_API_KEY` | å¦ | Anthropic APIå¯†é’¥ | sk-ant-xxxxx |
| `QWEN_API_KEY` | å¦ | é€šä¹‰åƒé—®APIå¯†é’¥ | xxxxx |
| `ERNIE_API_KEY` | å¦ | æ–‡å¿ƒä¸€è¨€APIå¯†é’¥ | xxxxx |
| `DOUBAO_API_KEY` | å¦ | æŠ–éŸ³è±†åŒ…APIå¯†é’¥ | xxxxx |
| `NODE_ENV` | æ˜¯ | è¿è¡Œç¯å¢ƒ | production |
| `PORT` | æ˜¯ | æœåŠ¡ç«¯å£ | 3000 |
| `HOST` | æ˜¯ | ç»‘å®šåœ°å€ | 0.0.0.0 |
| `DOMAIN` | å¦ | åŸŸå | your-domain.com |

### PM2é…ç½®

`ecosystem.config.js` é…ç½®è¯´æ˜ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'novel-ai-forge',
    script: 'npm',
    args: 'run start',
    instances: 'max', // ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'development',
      PORT: 3000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000,
      HOST: '0.0.0.0'
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true,
    max_restarts: 10,
    min_uptime: '10s'
  }]
};
```

### Dockeré…ç½®

`docker-compose.yml` è¯´æ˜ï¼š

```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
    volumes:
      - ./data:/app/data  # æ•°æ®æŒä¹…åŒ–
      - ./logs:/app/logs # æ—¥å¿—æŒä¹…åŒ–
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

## ç»´æŠ¤ä¸ç›‘æ§

### æ€§èƒ½ç›‘æ§

1. **PM2ç›‘æ§**
```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
pm2 show novel-ai-forge

# ç›‘æ§æ¨¡å¼
pm2 monit

# æŸ¥çœ‹èµ„æºä½¿ç”¨
pm2 plus  # éœ€è¦æ³¨å†ŒPM2 Plus
```

2. **ç³»ç»Ÿèµ„æºç›‘æ§**
```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top
htop

# ç£ç›˜ä½¿ç”¨
df -h
du -sh /var/www/novel-ai-forge

# ç½‘ç»œè¿æ¥
netstat -tlnp | grep :3000
```

### æ—¥å¿—ç®¡ç†

1. **PM2æ—¥å¿—**
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
pm2 logs novel-ai-forge

# æŸ¥çœ‹ç‰¹å®šæ•°é‡çš„æ—¥å¿—
pm2 logs novel-ai-forge --lines 1000

# æ¸…ç©ºæ—¥å¿—
pm2 flush novel-ai-forge
```

2. **ç³»ç»Ÿæ—¥å¿—**
```bash
# journalctlæ—¥å¿—
sudo journalctl -u novel-ai-forge -f
sudo journalctl -u novel-ai-forge --since "1 hour ago"

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
sudo journalctl -u novel-ai-forge > novel-ai-forge.log
```

### å¤‡ä»½ç­–ç•¥

1. **è‡ªåŠ¨å¤‡ä»½è„šæœ¬**
```bash
#!/bin/bash
# scripts/backup.sh

BACKUP_DIR="/var/backups/novel-ai-forge"
DATE=$(date +%Y%m%d_%H%M%S)
APP_DIR="/var/www/novel-ai-forge"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½åº”ç”¨æ•°æ®
tar -czf $BACKUP_DIR/app_backup_$DATE.tar.gz $APP_DIR/data/
tar -czf $BACKUP_DIR/logs_backup_$DATE.tar.gz $APP_DIR/logs/

# å¤‡ä»½PM2é…ç½®
pm2 dump > $BACKUP_DIR/pm2_backup_$DATE.json

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
find $BACKUP_DIR -name "*.json" -mtime +30 -delete

echo "Backup completed: $DATE"
```

2. **å®šæ—¶å¤‡ä»½**
```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
0 2 * * * /var/www/novel-ai-forge/scripts/backup.sh >> /var/log/novel-ai-forge-backup.log 2>&1
```

### æ›´æ–°éƒ¨ç½²

1. **æ‰‹åŠ¨æ›´æ–°**
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/novel-ai-forge

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
./scripts/backup.sh

# è·å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…æ–°ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# é‡å¯åº”ç”¨
pm2 restart novel-ai-forge
```

2. **è‡ªåŠ¨åŒ–æ›´æ–°è„šæœ¬**
```bash
#!/bin/bash
# scripts/update.sh

set -e

echo "Starting update..."
cd /var/www/novel-ai-forge

# å¤‡ä»½
echo "Creating backup..."
./scripts/backup.sh

# è·å–æ›´æ–°
echo "Fetching updates..."
git pull origin main

# å®‰è£…ä¾èµ–
echo "Installing dependencies..."
npm install

# æ„å»º
echo "Building application..."
npm run build

# é‡å¯æœåŠ¡
echo "Restarting application..."
pm2 reload ecosystem.config.js

echo "Update completed successfully!"
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. åº”ç”¨æ— æ³•å¯åŠ¨

**é—®é¢˜ç°è±¡**ï¼šPM2æ˜¾ç¤ºåº”ç”¨çŠ¶æ€ä¸º"errored"æˆ–Dockerå®¹å™¨é€€å‡º

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æ£€æŸ¥PM2æ—¥å¿—
pm2 logs novel-ai-forge

# æ£€æŸ¥Dockeræ—¥å¿—
docker-compose logs app

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®
- æ£€æŸ¥APIå¯†é’¥æœ‰æ•ˆæ€§
- ç¡®ä¿ç«¯å£3000æœªè¢«å ç”¨
- ä½¿ç”¨Node.js 18.xç‰ˆæœ¬

#### 2. å†…å­˜ä¸è¶³

**é—®é¢˜ç°è±¡**ï¼šåº”ç”¨è¿è¡Œç¼“æ…¢æˆ–ç»å¸¸é‡å¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¢åŠ PM2å†…å­˜é™åˆ¶
pm2 start ecosystem.config.js --max-memory-restart 500M

# æ£€æŸ¥ç³»ç»Ÿå†…å­˜
free -h

# å¢åŠ swapç©ºé—´
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### 3. APIè°ƒç”¨å¤±è´¥

**é—®é¢˜ç°è±¡**ï¼šAIç”ŸæˆåŠŸèƒ½æ— æ³•å·¥ä½œ

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æµ‹è¯•APIè¿æ¥
curl -H "Authorization: Bearer $OPENAI_API_KEY" https://api.openai.com/v1/models

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping api.openai.com

# æ£€æŸ¥ä»£ç†è®¾ç½®
env | grep -i proxy
```

#### 4. æ„å»ºå¤±è´¥

**é—®é¢˜ç°è±¡**ï¼š`npm run build` æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force
rm -rf node_modules
rm -rf .next

# é‡æ–°å®‰è£…
npm install

# æ£€æŸ¥Node.jsç‰ˆæœ¬å…¼å®¹æ€§
npm doctor
```

#### 5. æ•°æ®åº“é—®é¢˜

**é—®é¢˜ç°è±¡**ï¼šæ•°æ®æ— æ³•ä¿å­˜æˆ–è¯»å–

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æ£€æŸ¥PouchDBæ•°æ®æ–‡ä»¶
ls -la ./data/

# æ£€æŸ¥æµè§ˆå™¨IndexedDB
# åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹Application > IndexedDB

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. Node.jsæ€§èƒ½è°ƒä¼˜

```bash
# è®¾ç½®Node.jså‚æ•°
export NODE_OPTIONS="--max-old-space-size=2048 --optimize-for-size"

# PM2é…ç½®ä¼˜åŒ–
pm2 start ecosystem.config.js --node-args="--max-old-space-size=2048"
```

#### 2. ç³»ç»Ÿä¼˜åŒ–

```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
ulimit -n 65536

# ä¼˜åŒ–å†…æ ¸å‚æ•°
echo 'net.core.somaxconn = 65536' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

#### 3. æ•°æ®åº“ä¼˜åŒ–

- å®šæœŸæ¸…ç†å†å²æ•°æ®
- å¯ç”¨æµè§ˆå™¨IndexedDBå‹ç¼©
- è€ƒè™‘ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰

### ç½‘ç»œé—®é¢˜æ’æŸ¥

#### 1. é˜²ç«å¢™é…ç½®

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status
sudo iptables -L

# å…è®¸åº”ç”¨ç«¯å£
sudo ufw allow 3000
```

#### 2. ä»£ç†é…ç½®

```bash
# æ£€æŸ¥ä»£ç†è®¾ç½®
env | grep -i proxy

# è®¾ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
export HTTP_PROXY=http://proxy.company.com:8080
export HTTPS_PROXY=http://proxy.company.com:8080
```

## å®‰å…¨å»ºè®®

### 1. APIå¯†é’¥å®‰å…¨

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨APIå¯†é’¥
- âœ… å®šæœŸè½®æ¢APIå¯†é’¥
- âœ… é™åˆ¶APIå¯†é’¥çš„æƒé™èŒƒå›´
- âŒ ä¸è¦å°†APIå¯†é’¥æäº¤åˆ°ä»£ç ä»“åº“
- âŒ ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²APIå¯†é’¥

### 2. æœåŠ¡å™¨å®‰å…¨

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade

# é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 3000

# è®¾ç½®Fail2ban
sudo apt install fail2ban
sudo systemctl enable fail2ban
```

### 3. åº”ç”¨å®‰å…¨

- å¯ç”¨HTTPSï¼ˆä½¿ç”¨Let's Encryptï¼‰
- é…ç½®å®‰å…¨å¤´ï¼ˆX-Frame-Options, CSPç­‰ï¼‰
- é™åˆ¶è®¿é—®é€Ÿç‡
- å®šæœŸå¤‡ä»½æ•°æ®
- ç›‘æ§å¼‚å¸¸è®¿é—®

### 4. æ•°æ®å¤‡ä»½åŠ å¯†

```bash
# åŠ å¯†å¤‡ä»½æ–‡ä»¶
tar -czf - data/ | gpg --cipher-algo AES256 --compress-algo 1 --s2k-mode 3 --s2k-digest-algo SHA512 --s2k-count 65536 --force-mdc --quiet --no-greeting -c > backup_$(date +%Y%m%d).tar.gz.gpg

# è§£å¯†å¤‡ä»½æ–‡ä»¶
gpg --decrypt backup_YYYYMMDD.tar.gz.gpg | tar -xzf -
```

### 5. ç›‘æ§å‘Šè­¦

è®¾ç½®å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š

```bash
# CPUä½¿ç”¨ç‡å‘Šè­¦
*/5 * * * * /usr/local/bin/check_cpu.sh

# å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦  
*/5 * * * * /usr/local/bin/check_memory.sh

# ç£ç›˜ç©ºé—´å‘Šè­¦
*/10 * * * * /usr/local/bin/check_disk.sh
```

## ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºé¡¹ç›®
- ç‚¹å‡»å·¦ä¾§è¾¹æ çš„ã€Œæ–°å»ºé¡¹ç›®ã€
- è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°

### 2. åˆ›å»ºç« èŠ‚
- åœ¨é¡¹ç›®ä¸‹ç‚¹å‡»ã€Œæ–°å»ºç« èŠ‚ã€
- è¾“å…¥ç« èŠ‚æ ‡é¢˜

### 3. åˆ›ä½œå†…å®¹
- åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥å†…å®¹
- ä½¿ç”¨å·¥å…·æ æ ¼å¼åŒ–æ–‡å­—
- é€‰ä¸­æ–‡å­—åç‚¹å‡»ã€ŒAIæ“ä½œã€æŒ‰é’®

### 4. é…ç½®AIæ¨¡å‹
- ç‚¹å‡»å·¦ä¾§è¾¹æ çš„ã€Œè®¾ç½®ã€
- é€‰æ‹©AIæœåŠ¡æä¾›å•†
- è¾“å…¥APIå¯†é’¥å¹¶ä¿å­˜
- è®¾ç½®é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹

### 5. ä½¿ç”¨ä½œå“åœ£ç»
- ç‚¹å‡»ã€Œè§’è‰²è®¾å®šã€ç®¡ç†è§’è‰²
- åˆ›å»ºè§’è‰²å¡ç‰‡ï¼Œå¡«å†™è¯¦ç»†ä¿¡æ¯
- AIä¼šè‡ªåŠ¨å‚è€ƒè¿™äº›ä¿¡æ¯ç”Ÿæˆå†…å®¹

## é…ç½®AIæ¨¡å‹

### OpenAI
1. è·å–APIå¯†é’¥: https://platform.openai.com/api-keys
2. åœ¨è®¾ç½®ä¸­è¾“å…¥APIå¯†é’¥

### Anthropic Claude
1. è·å–APIå¯†é’¥: https://console.anthropic.com/
2. åœ¨è®¾ç½®ä¸­è¾“å…¥APIå¯†é’¥

### é€šä¹‰åƒé—® (é˜¿é‡Œäº‘)
1. è·å–APIå¯†é’¥: https://dashscope.console.aliyun.com/
2. åœ¨è®¾ç½®ä¸­è¾“å…¥APIå¯†é’¥

### æ–‡å¿ƒä¸€è¨€ (ç™¾åº¦)
1. è·å–APIå¯†é’¥: https://console.bce.baidu.com/
2. éœ€è¦å…ˆè·å–access_token

### è±†åŒ… (å­—èŠ‚è·³åŠ¨)
1. è·å–APIå¯†é’¥: https://console.volcengine.com/
2. åœ¨è®¾ç½®ä¸­è¾“å…¥APIå¯†é’¥

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx           # ä¸»é¡µé¢
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ editor/            # ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ sidebar/           # ä¾§è¾¹æ ç»„ä»¶
â”‚   â”œâ”€â”€ bible/             # ä½œå“åœ£ç»ç»„ä»¶
â”‚   â”œâ”€â”€ chat/              # AIèŠå¤©ç»„ä»¶
â”‚   â”œâ”€â”€ settings/          # è®¾ç½®é¢æ¿ç»„ä»¶
â”‚   â””â”€â”€ ui/                # åŸºç¡€UIç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ ai-service.ts      # AIæœåŠ¡é›†æˆ
â”‚   â”œâ”€â”€ db.ts              # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ project-store.ts   # é¡¹ç›®çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ settings-store.ts  # è®¾ç½®çŠ¶æ€ç®¡ç†
â””â”€â”€ types/
    â””â”€â”€ index.ts           # TypeScriptç±»å‹å®šä¹‰
```

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 14
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS + shadcn/ui
- **ç¼–è¾‘å™¨**: TipTap (ProseMirror)
- **çŠ¶æ€ç®¡ç†**: Zustand
- **æœ¬åœ°å­˜å‚¨**: PouchDB (IndexedDB)
- **AIé›†æˆ**: Vercel AI SDK å…¼å®¹æ¥å£

## éšç§è¯´æ˜

- æ‰€æœ‰APIå¯†é’¥ä»…å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­
- ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨
- ä¸ä¼šå°†ä½ çš„åˆ›ä½œå†…å®¹ç”¨äºæ¨¡å‹è®­ç»ƒ
- å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®APIå¯†é’¥ä»¥æé«˜å®‰å…¨æ€§

## è®¸å¯

MIT License

---

## æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„[æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)éƒ¨åˆ†
2. æ£€æŸ¥é¡¹ç›®çš„GitHub Issues
3. åˆ›å»ºæ–°çš„Issueå¹¶æä¾›è¯¦ç»†ä¿¡æ¯
